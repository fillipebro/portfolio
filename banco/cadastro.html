<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cadastro — Bradesco Digital</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-app">
  <canvas id="bgParticles"></canvas>
  <a class="corner-logo" href="index.html" aria-label="Voltar para a página inicial">
    <img src="img/logo.png" alt="Bradesco">
  </a>

  <div class="center-area">
    <section class="card auth-card" role="form" aria-label="Formulário de Cadastro" style="overflow:visible">
      <h2>Crie sua conta</h2>
      <div id="cadAlert" class="alert" role="alert"></div>
      <form id="cadastroForm" class="form" autocomplete="on">
        <label class="field"><span>Nome completo</span><input type="text" id="nome" required autocomplete="name"></label>
        <label class="field"><span>CPF</span><input type="text" id="cpf" class="cpf-input" maxlength="14" placeholder="000.000.000-00" required inputmode="numeric" autocomplete="off"></label>
        <label class="field"><span>E‑mail</span><input type="email" id="email" required autocomplete="email"></label>
        <label class="field"><span>Senha</span><input type="password" id="senha" required autocomplete="new-password"></label>
        <label class="field"><span>Confirmar senha</span><input type="password" id="confirmarSenha" required autocomplete="new-password"></label>
        <button type="submit" class="btn btn-primary full" id="cadSubmit">Cadastrar</button>
      </form>
      <p class="muted">Já tem conta? <a href="login.html">Fazer login</a></p>
    </section>
  </div>

  <script src="js/cpf.js"></script>
  <script src="js/api.js"></script>
  <script src="js/anim.js"></script>
  <script>
    const cadForm = document.getElementById('cadastroForm');
    const cadBtn  = document.getElementById('cadSubmit');
    const cadAlert = document.getElementById('cadAlert');

    function showAlert(el, type, msg){
      el.className = 'alert show ' + type;
      el.textContent = msg;
    }

    cadForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      cadAlert.className = 'alert'; cadAlert.textContent = '';
      const nome = document.getElementById('nome').value.trim();
      const cpf  = CPFUtils.cleanCPF(document.getElementById('cpf').value);
      const email= document.getElementById('email').value.trim();
      const senha= document.getElementById('senha').value;
      const conf = document.getElementById('confirmarSenha').value;
      if(!nome || !cpf || !email || !senha){ showAlert(cadAlert, 'error', 'Preencha todos os campos.'); return; }
      if(senha !== conf){ showAlert(cadAlert, 'error', 'As senhas não coincidem.'); return; }
      if(!CPFUtils.validateCPF(cpf)){ showAlert(cadAlert, 'error', 'CPF inválido. Confira os dígitos.'); return; }

      const payload = { name: nome, cpf, email, password: senha };

      try{
        cadBtn.disabled = true; cadBtn.textContent = 'Cadastrando...';
        const data = await API.apiPost('/api/auth/register', payload);
        showAlert(cadAlert, 'success', 'Cadastro realizado com sucesso! Redirecionando...');
        setTimeout(()=> window.location.href = 'login.html', 1200);
      }catch(err){
        showAlert(cadAlert, 'error', err.message || 'Erro ao cadastrar.');
      }finally{
        cadBtn.disabled = false; cadBtn.textContent = 'Cadastrar';
      }
    });
  </script>
</body>
</html>
